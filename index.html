<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Book Library & Study Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .nav-tab:hover, .nav-tab.active {
            background: white;
            color: #667eea;
        }

        .timer-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin-top: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .timer-display {
            font-size: 3em;
            font-weight: bold;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-secondary {
            background: #718096;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f7fafc;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #718096;
            font-size: 1em;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .categories {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-btn.active {
            background: #667eea;
            color: white;
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .book-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .book-card h3 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 1.4em;
        }

        .book-card p {
            color: #718096;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .book-card .category-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .book-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .icon-btn {
            padding: 8px 12px;
            border: none;
            background: #f7fafc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .icon-btn:hover {
            background: #e2e8f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2d3748;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .chapter-item {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chapter-item:hover {
            background: #edf2f7;
        }

        .chapter-item h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .topics-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .topic-tag {
            background: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            color: #667eea;
            border: 1px solid #667eea;
        }

        .link-tag {
            background: #48bb78;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .link-tag:hover {
            background: #38a169;
        }

        .back-btn {
            margin-bottom: 20px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .input-with-btn {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .input-with-btn input {
            flex: 1;
        }

        .hidden {
            display: none;
        }

        .timetable-grid {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            gap: 1px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
        }

        .timetable-cell {
            background: white;
            padding: 15px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .timetable-header {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .timetable-time {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }

        .timetable-slot {
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .timetable-slot:hover {
            background: #f7fafc;
        }

        .timetable-slot.filled {
            background: #e6fffa;
            border-left: 4px solid #48bb78;
        }

        .slot-content {
            font-size: 0.9em;
            color: #2d3748;
            text-align: center;
        }

        .notice-board {
            background: #fff5e6;
            border: 2px solid #ed8936;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .notice-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #ed8936;
        }

        .notice-item h4 {
            color: #2d3748;
            margin-bottom: 5px;
        }

        .notice-item p {
            color: #718096;
            font-size: 0.95em;
        }

        .notice-item .notice-date {
            font-size: 0.85em;
            color: #a0aec0;
            margin-top: 5px;
        }

        .reading-log {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .log-entry {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-entry .log-info {
            flex: 1;
        }

        .log-entry .log-time {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #48bb78 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .goal-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .goal-card h3 {
            margin-bottom: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideDown 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #718096;
            cursor: pointer;
        }

        .close-modal:hover {
            color: #2d3748;
        }

        .schedule-item {
            background: white;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .schedule-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .schedule-item.completed {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .schedule-item.missed {
            border-left-color: #f56565;
            background: #fff5f5;
        }

        .schedule-info h4 {
            color: #2d3748;
            margin-bottom: 5px;
        }

        .schedule-info p {
            color: #718096;
            font-size: 0.9em;
            margin: 3px 0;
        }

        .schedule-actions {
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .schedule-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-pending {
            background: #fef5e7;
            color: #ed8936;
        }

        .status-completed {
            background: #f0fff4;
            color: #48bb78;
        }

        .status-missed {
            background: #fff5f5;
            color: #f56565;
        }

        .missed-list {
            background: #fff5f5;
            border: 2px solid #f56565;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .missed-list h3 {
            color: #f56565;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .timer-display {
                font-size: 2em;
            }

            .books-grid {
                grid-template-columns: 1fr;
            }

            .stats-section {
                grid-template-columns: 1fr;
            }

            .timetable-grid {
                grid-template-columns: 80px repeat(7, 1fr);
                font-size: 0.85em;
            }

            .timetable-cell {
                padding: 10px;
                min-height: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="mainHeading">üìö Personal Book Library & Study Tracker</h1>
            <div id="headerNotice" style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-top: 15px; display: none;">
                <div id="activeScheduleNotice" style="font-size: 1.1em; font-weight: 600;"></div>
            </div>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('library')">üìö Library</button>
                <button class="nav-tab" onclick="switchTab('timetable')">üìÖ Timetable</button>
                <button class="nav-tab" onclick="switchTab('tracker')">üìä Reading Tracker</button>
                <button class="nav-tab" onclick="switchTab('notices')">üìå Notice Board</button>
                <button class="nav-tab" onclick="switchTab('goals')">üéØ Goals</button>
                <button class="nav-tab" onclick="logout()" style="background: rgba(245, 101, 101, 0.2); border: 2px solid #f56565;">üîì Logout</button>
            </div>
            <div class="timer-section">
                <div style="text-align: center; width: 100%;">
                    <h2 style="margin-bottom: 15px;">üìÖ Reading Schedule</h2>
                    <button class="btn btn-success" onclick="showAddScheduleForm()">‚ûï Add Reading Schedule</button>
                </div>
            </div>
            
            <!-- Schedule Form Modal -->
            <div id="scheduleModal" class="modal hidden">
                <div class="modal-content">
                    <span class="close-modal" onclick="closeScheduleModal()">&times;</span>
                    <h3>Add Reading Schedule</h3>
                    <div class="form-group">
                        <label>Select Book</label>
                        <select id="scheduleBook"></select>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="scheduleDate">
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="scheduleTime">
                    </div>
                    <div class="form-group">
                        <label>Duration (minutes)</label>
                        <input type="number" id="scheduleDuration" value="30" min="5">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="scheduleNotes" placeholder="Chapter to read, pages, etc..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveSchedule()">üíæ Save Schedule</button>
                    <button class="btn btn-secondary" onclick="closeScheduleModal()">‚ùå Cancel</button>
                </div>
            </div>
        </div>

        <div class="stats-section">
            <div class="stat-card">
                <h3 id="totalBooks">0</h3>
                <p>Total Books</p>
            </div>
            <div class="stat-card">
                <h3 id="totalChapters">0</h3>
                <p>Total Chapters</p>
            </div>
            <div class="stat-card">
                <h3 id="todayReading">0</h3>
                <p>Today's Reading (min)</p>
            </div>
            <div class="stat-card">
                <h3 id="weeklyReading">0</h3>
                <p>Weekly Reading (min)</p>
            </div>
            <div class="stat-card">
                <h3 id="currentDate">-</h3>
                <p>Today's Date</p>
            </div>
        </div>

        <div class="content">
            <!-- Library Tab -->
            <div id="libraryTab" class="tab-content active">
                <div id="libraryView">
                    <div class="categories" id="categoriesContainer"></div>
                    <button class="btn btn-primary" onclick="showAddBookForm()">‚ûï Add New Book</button>
                    <div class="books-grid" id="booksGrid"></div>
                </div>

                <div id="addBookView" class="hidden">
                    <button class="btn btn-secondary back-btn" onclick="showLibrary()">‚¨ÖÔ∏è Back to Library</button>
                    <h2 id="formTitle">Add New Book</h2>
                    <div class="form-group">
                        <label>Book Title</label>
                        <input type="text" id="bookTitle" placeholder="Enter book title">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="bookDesc" placeholder="Brief description of the book"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="bookCategory"></select>
                    </div>
                    <div class="form-group">
                        <label>Author</label>
                        <input type="text" id="bookAuthor" placeholder="Author name">
                    </div>
                    <button class="btn btn-primary" id="saveBookBtn" onclick="saveBook()">üíæ Save Book</button>
                </div>

                <div id="bookDetailView" class="hidden">
                    <button class="btn btn-secondary back-btn" onclick="showLibrary()">‚¨ÖÔ∏è Back to Library</button>
                    <div id="bookDetailContent"></div>
                </div>

                <div id="chapterDetailView" class="hidden">
                    <button class="btn btn-secondary back-btn" onclick="backToBook()">‚¨ÖÔ∏è Back to Book</button>
                    <div id="chapterDetailContent"></div>
                </div>
            </div>

            <!-- Timetable Tab -->
            <div id="timetableTab" class="tab-content">
                <h2>Weekly Study Timetable</h2>
                <p style="color: #718096; margin: 10px 0;">Click on any slot to add your study schedule</p>
                <div id="timetableGrid"></div>
            </div>

            <!-- Tracker Tab -->
            <div id="trackerTab" class="tab-content">
                <h2>Reading Progress Tracker</h2>
                <div class="reading-log">
                    <h3>Reading Sessions</h3>
                    <button class="btn btn-primary" style="margin: 15px 0;" onclick="showAddSessionForm()">‚ûï Log Reading Session</button>
                    <div id="sessionsList"></div>
                </div>

                <div id="addSessionForm" class="hidden" style="background: #f7fafc; padding: 20px; border-radius: 12px; margin-top: 20px;">
                    <h3>Log New Reading Session</h3>
                    <div class="form-group">
                        <label>Select Book</label>
                        <select id="sessionBook"></select>
                    </div>
                    <div class="form-group">
                        <label>Duration (minutes)</label>
                        <input type="number" id="sessionDuration" min="1" value="30">
                    </div>
                    <div class="form-group">
                        <label>Pages Read</label>
                        <input type="number" id="sessionPages" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="sessionNotes" placeholder="Any notes or reflections..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveSession()">üíæ Save Session</button>
                    <button class="btn btn-secondary" onclick="cancelSessionForm()">‚ùå Cancel</button>
                </div>
            </div>

            <!-- Notices Tab -->
            <div id="noticesTab" class="tab-content">
                <h2>Notice Board & Reading Reminders</h2>
                
                <!-- Today's Schedule Section -->
                <div style="background: #e6fffa; border: 2px solid #48bb78; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #48bb78; margin-bottom: 15px;">üìö Today's Reading Schedule</h3>
                    <div id="todaySchedule"></div>
                </div>

                <!-- Upcoming Schedule Section -->
                <div style="background: #fef5e7; border: 2px solid #ed8936; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #ed8936; margin-bottom: 15px;">‚è∞ Upcoming Reading Schedule</h3>
                    <div id="upcomingSchedule"></div>
                </div>

                <!-- Missed Reading List -->
                <div id="missedReadingSection" class="missed-list hidden">
                    <h3>‚ùå Missed Reading Sessions</h3>
                    <div id="missedSchedule"></div>
                </div>

                <hr style="margin: 30px 0; border: 1px solid #e2e8f0;">

                <h3>üìå General Notices</h3>
                <button class="btn btn-primary" style="margin: 15px 0;" onclick="showAddNoticeForm()">‚ûï Add Notice</button>
                <div class="notice-board" id="noticeBoard"></div>

                <div id="addNoticeForm" class="hidden" style="background: #f7fafc; padding: 20px; border-radius: 12px; margin-top: 20px;">
                    <h3>Add New Notice</h3>
                    <div class="form-group">
                        <label>Notice Title</label>
                        <input type="text" id="noticeTitle" placeholder="Enter notice title">
                    </div>
                    <div class="form-group">
                        <label>Notice Content</label>
                        <textarea id="noticeContent" placeholder="Enter notice details..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="noticePriority">
                            <option>High</option>
                            <option>Medium</option>
                            <option>Low</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="saveNotice()">üíæ Save Notice</button>
                    <button class="btn btn-secondary" onclick="cancelNoticeForm()">‚ùå Cancel</button>
                </div>
            </div>

            <!-- Goals Tab -->
            <div id="goalsTab" class="tab-content">
                <h2>Reading Goals</h2>
                <button class="btn btn-primary" style="margin: 15px 0;" onclick="showAddGoalForm()">‚ûï Set New Goal</button>
                <div id="goalsList"></div>

                <div id="addGoalForm" class="hidden" style="background: #f7fafc; padding: 20px; border-radius: 12px; margin-top: 20px;">
                    <h3>Set New Reading Goal</h3>
                    <div class="form-group">
                        <label>Goal Type</label>
                        <select id="goalType">
                            <option>Books to Read</option>
                            <option>Pages to Read</option>
                            <option>Reading Time (hours)</option>
                            <option>Chapters to Complete</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Target Number</label>
                        <input type="number" id="goalTarget" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>Time Period</label>
                        <select id="goalPeriod">
                            <option>Weekly</option>
                            <option>Monthly</option>
                            <option>Yearly</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="saveGoal()">üíæ Save Goal</button>
                    <button class="btn btn-secondary" onclick="cancelGoalForm()">‚ùå Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Security layer
        var _0x4a2b=['\x61\x75\x74\x68\x65\x6e\x74\x69\x63\x61\x74\x65\x64','\x67\x65\x74\x49\x74\x65\x6d','\x74\x72\x75\x65','\x73\x65\x74\x49\x74\x65\x6d','\x72\x65\x6d\x6f\x76\x65\x49\x74\x65\x6d'];function _0x3f8a(_0x4d7c8a,_0x2e8f05){_0x4d7c8a=_0x4d7c8a-0x0;var _0x4a2b77=_0x4a2b[_0x4d7c8a];return _0x4a2b77;}
        
        function checkAuth(){var _0x8d=sessionStorage[_0x3f8a('0x1')](_0x3f8a('0x0'));if(_0x8d===_0x3f8a('0x2'))return!0x0;var _0x5f=prompt('\uD83D\uDD10 Enter ID:');var _0x9a=String['fromCharCode'](0x31,0x37,0x30,0x39,0x36,0x39,0x39);if(_0x5f!==_0x9a){alert('\u274C Invalid!');document['body']['innerHTML']='<div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><div style="background: white; padding: 40px; border-radius: 20px; text-align: center;"><h1 style="color: #f56565;">\u274C Access Denied</h1><p style="color: #718096; margin: 20px 0;">Invalid!</p><button onclick="location.reload()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">Try Again</button></div></div>';return!0x1;}var _0x2c=prompt('\uD83D\uDD11 Enter Code (8 digits):');if(validateCode(_0x2c)){sessionStorage[_0x3f8a('0x3')](_0x3f8a('0x0'),_0x3f8a('0x2'));return!0x0;}else{alert('\u274C Invalid Code!');document['body']['innerHTML']='<div style="display: flex; justify-content: center; align-items: center; height: 100vh; font-family: Arial; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><div style="background: white; padding: 40px; border-radius: 20px; text-align: center;"><h1 style="color: #f56565;">\u274C Access Denied</h1><p style="color: #718096; margin: 20px 0;">Invalid code!</p><button onclick="location.reload()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">Try Again</button></div></div>';return!0x1;}}
        
        function validateCode(_0x7b){if(!_0x7b||_0x7b['length']!==0x8)return!0x1;var _0x1d=new Date();var _0x3e=String(_0x1d['getDate']())['padStart'](0x2,'0');var _0x4f=String(_0x1d['getMonth']()+0x1)['padStart'](0x2,'0');var _0x5e=String(_0x1d['getHours']())['padStart'](0x2,'0');var _0x6d=String(_0x1d['getMinutes']())['padStart'](0x2,'0');var _0x2f=_0x3e+_0x4f+_0x5e+_0x6d;var _0x8e=parseInt(_0x6d);var _0x9f=[_0x2f];if(_0x8e>0x0){var _0x1e=String(_0x8e-0x1)['padStart'](0x2,'0');_0x9f['push'](_0x3e+_0x4f+_0x5e+_0x1e);}if(_0x8e<0x3b){var _0x2e=String(_0x8e+0x1)['padStart'](0x2,'0');_0x9f['push'](_0x3e+_0x4f+_0x5e+_0x2e);}return _0x9f['includes'](_0x7b);}
        
        function logout(){if(confirm('Logout?')){sessionStorage[_0x3f8a('0x4')](_0x3f8a('0x0'));location['reload']();}}
        
        if(!checkAuth())throw new Error('Auth failed');

        // Data structures
        var books = [];
        var timetable = {};
        var readingSessions = [];
        var notices = [];
        var goals = [];
        var readingSchedules = [];
        var categories = ['Fiction', 'Non-Fiction', 'Technical', 'Self-Help', 'Academic', 'Other'];
        var currentFilter = 'All';
        var currentBookId = null;
        var currentChapterId = null;
        var timerInterval = null;
        var totalReadingTime = 0;
        var todayReadingTime = 0;
        var weeklyReadingTime = 0;
        var tempTopics = [];
        var editingBookId = null;
        var editingChapterId = null;
        var currentTab = 'library';

        // Time slots for timetable
        var timeSlots = ['6:00 AM', '7:00 AM', '8:00 AM', '9:00 AM', '10:00 AM', '11:00 AM', 
                        '12:00 PM', '1:00 PM', '2:00 PM', '3:00 PM', '4:00 PM', '5:00 PM', 
                        '6:00 PM', '7:00 PM', '8:00 PM', '9:00 PM', '10:00 PM'];
        var weekDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

        // Initialize app
        function init() {
            loadData();
            updateStats();
            updateCurrentDate();
            renderCategories();
            renderBooks();
            renderTimetable();
            renderSessions();
            renderNotices();
            renderGoals();
            renderSchedules();
            checkScheduleReminders();
            updateHeaderNotice();
            
            // Check for reminders every minute
            setInterval(function() {
                checkScheduleReminders();
                updateHeaderNotice();
            }, 60000);
        }

        // Load data from localStorage
        function loadData() {
            var savedBooks = localStorage.getItem('books');
            var savedTime = localStorage.getItem('totalReadingTime');
            var savedTodayTime = localStorage.getItem('todayReadingTime');
            var savedWeeklyTime = localStorage.getItem('weeklyReadingTime');
            var savedTimetable = localStorage.getItem('timetable');
            var savedSessions = localStorage.getItem('readingSessions');
            var savedNotices = localStorage.getItem('notices');
            var savedGoals = localStorage.getItem('goals');
            var savedSchedules = localStorage.getItem('readingSchedules');
            var savedCategories = localStorage.getItem('categories');
            var savedDate = localStorage.getItem('lastAccessDate');
            
            if (savedBooks) books = JSON.parse(savedBooks);
            if (savedTime) totalReadingTime = parseInt(savedTime);
            if (savedTodayTime) todayReadingTime = parseInt(savedTodayTime);
            if (savedWeeklyTime) weeklyReadingTime = parseInt(savedWeeklyTime);
            if (savedTimetable) timetable = JSON.parse(savedTimetable);
            if (savedSessions) readingSessions = JSON.parse(savedSessions);
            if (savedNotices) notices = JSON.parse(savedNotices);
            if (savedGoals) goals = JSON.parse(savedGoals);
            if (savedSchedules) readingSchedules = JSON.parse(savedSchedules);
            if (savedCategories) categories = JSON.parse(savedCategories);

            // Reset daily/weekly stats if new day/week
            var today = new Date().toDateString();
            if (savedDate !== today) {
                todayReadingTime = 0;
                var lastDate = new Date(savedDate);
                var currentDate = new Date();
                if (getWeekNumber(lastDate) !== getWeekNumber(currentDate)) {
                    weeklyReadingTime = 0;
                }
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('books', JSON.stringify(books));
            localStorage.setItem('totalReadingTime', totalReadingTime.toString());
            localStorage.setItem('todayReadingTime', todayReadingTime.toString());
            localStorage.setItem('weeklyReadingTime', weeklyReadingTime.toString());
            localStorage.setItem('timetable', JSON.stringify(timetable));
            localStorage.setItem('readingSessions', JSON.stringify(readingSessions));
            localStorage.setItem('notices', JSON.stringify(notices));
            localStorage.setItem('goals', JSON.stringify(goals));
            localStorage.setItem('readingSchedules', JSON.stringify(readingSchedules));
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('lastAccessDate', new Date().toDateString());
        }

        function getWeekNumber(date) {
            var d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            var dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
        }

        // Update header notice with current schedule
        function updateHeaderNotice() {
            var now = new Date();
            var currentTime = now.getTime();
            var headerNotice = document.getElementById('headerNotice');
            var noticeText = document.getElementById('activeScheduleNotice');
            var mainHeading = document.getElementById('mainHeading');
            
            var upcomingSchedules = readingSchedules.filter(function(s) {
                if (s.status !== 'pending') return false;
                var scheduleTime = new Date(s.date + 'T' + s.time).getTime();
                return scheduleTime > currentTime && scheduleTime - currentTime <= 3600000; // Next hour
            }).sort(function(a, b) {
                return new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time);
            });

            var missedCount = readingSchedules.filter(function(s) {
                return s.status === 'missed';
            }).length;

            if (upcomingSchedules.length > 0 || missedCount > 0) {
                var messages = [];
                
                if (upcomingSchedules.length > 0) {
                    var nextSchedule = upcomingSchedules[0];
                    var book = books.find(function(b) { return b.id === nextSchedule.bookId; });
                    var bookTitle = book ? book.title : 'Unknown Book';
                    var scheduleTime = new Date(nextSchedule.date + 'T' + nextSchedule.time);
                    var timeString = scheduleTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    
                    var minutesUntil = Math.floor((scheduleTime - now) / 60000);
                    if (minutesUntil <= 10) {
                        messages.push('‚è∞ URGENT: Read "' + bookTitle + '" in ' + minutesUntil + ' minutes!');
                    } else {
                        messages.push('üìö Upcoming: "' + bookTitle + '" at ' + timeString);
                    }
                }
                
                if (missedCount > 0) {
                    messages.push('‚ùå You have ' + missedCount + ' missed reading session' + (missedCount > 1 ? 's' : ''));
                }
                
                mainHeading.textContent = messages.join(' | ');
                headerNotice.style.display = 'none';
            } else {
                mainHeading.textContent = 'üìö Personal Book Library & Study Tracker';
                headerNotice.style.display = 'none';
            }
        }

        // Category Management Functions
        function renderCategories() {
            var container = document.getElementById('categoriesContainer');
            var html = '<button class="category-btn ' + (currentFilter === 'All' ? 'active' : '') + '" onclick="filterCategory(\'All\')">All</button>';
            
            categories.forEach(function(category) {
                html += '<button class="category-btn ' + (currentFilter === category ? 'active' : '') + '" onclick="filterCategory(\'' + category + '\')">' +
                    category + ' <span onclick="event.stopPropagation(); deleteCategory(\'' + category + '\')" style="margin-left: 5px; cursor: pointer; color: #f56565;">‚ùå</span></button>';
            });
            
            html += '<button class="btn btn-success btn-small" onclick="addNewCategory()">‚ûï Add</button>';
            container.innerHTML = html;
        }

        function addNewCategory() {
            var categoryName = prompt('Enter new category name:');
            if (categoryName && categoryName.trim()) {
                categoryName = categoryName.trim();
                if (categories.includes(categoryName)) {
                    alert('This category already exists!');
                    return;
                }
                categories.push(categoryName);
                saveData();
                renderCategories();
                showNotification('Category added successfully!');
            }
        }

        function deleteCategory(categoryName) {
            // Check if any books use this category
            var booksWithCategory = books.filter(function(book) {
                return book.category === categoryName;
            });

            if (booksWithCategory.length > 0) {
                var moveToOther = confirm(booksWithCategory.length + ' book(s) use this category.\n\nClick OK to move them to "Other" category, or Cancel to keep the category.');
                if (!moveToOther) return;
                
                // Move books to "Other"
                booksWithCategory.forEach(function(book) {
                    book.category = 'Other';
                });
            } else {
                if (!confirm('Delete category "' + categoryName + '"?')) return;
            }

            categories = categories.filter(function(c) { return c !== categoryName; });
            
            // Make sure "Other" always exists
            if (!categories.includes('Other')) {
                categories.push('Other');
            }
            
            saveData();
            renderCategories();
            renderBooks();
            showNotification('Category deleted!');
        }

        function updateCurrentDate() {
            var now = new Date();
            var options = { day: 'numeric', month: 'short', year: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        function updateStats() {
            var totalChapters = 0;
            books.forEach(function(book) {
                if (book.chapters) {
                    totalChapters += book.chapters.length;
                }
            });
            
            document.getElementById('totalBooks').textContent = books.length;
            document.getElementById('totalChapters').textContent = totalChapters;
            document.getElementById('todayReading').textContent = Math.floor(todayReadingTime / 60);
            document.getElementById('weeklyReading').textContent = Math.floor(weeklyReadingTime / 60);
        }

        // Tab switching
        function switchTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.nav-tab').forEach(function(tab) {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(function(content) {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'notices') {
                renderSchedules();
            }
        }

        // Schedule Functions
        function showAddScheduleForm() {
            if (books.length === 0) {
                alert('Please add some books first!');
                return;
            }

            var select = document.getElementById('scheduleBook');
            select.innerHTML = books.map(function(book) {
                return '<option value="' + book.id + '">' + book.title + '</option>';
            }).join('');

            var today = new Date().toISOString().split('T')[0];
            document.getElementById('scheduleDate').value = today;
            document.getElementById('scheduleTime').value = '09:00';
            document.getElementById('scheduleDuration').value = '30';
            document.getElementById('scheduleNotes').value = '';

            document.getElementById('scheduleModal').classList.remove('hidden');
            document.getElementById('scheduleModal').style.display = 'block';
        }

        function closeScheduleModal() {
            document.getElementById('scheduleModal').classList.add('hidden');
            document.getElementById('scheduleModal').style.display = 'none';
        }

        function saveSchedule() {
            var bookId = document.getElementById('scheduleBook').value;
            var date = document.getElementById('scheduleDate').value;
            var time = document.getElementById('scheduleTime').value;
            var duration = parseInt(document.getElementById('scheduleDuration').value);
            var notes = document.getElementById('scheduleNotes').value.trim();

            if (!bookId || !date || !time || !duration) {
                alert('Please fill in all required fields!');
                return;
            }

            var schedule = {
                id: Date.now().toString(),
                bookId: bookId,
                date: date,
                time: time,
                duration: duration,
                notes: notes,
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            readingSchedules.push(schedule);
            saveData();
            renderSchedules();
            closeScheduleModal();
            showNotification('Reading schedule added!');
        }

        function renderSchedules() {
            var today = new Date().toDateString();
            var now = new Date();

            var todaySchedules = [];
            var upcomingSchedules = [];
            var missedSchedules = [];

            readingSchedules.forEach(function(schedule) {
                var scheduleDate = new Date(schedule.date + 'T' + schedule.time);
                var scheduleDateString = scheduleDate.toDateString();

                if (schedule.status === 'pending' && scheduleDate < now) {
                    schedule.status = 'missed';
                }

                if (schedule.status === 'missed') {
                    missedSchedules.push(schedule);
                } else if (scheduleDateString === today) {
                    todaySchedules.push(schedule);
                } else if (scheduleDate > now) {
                    upcomingSchedules.push(schedule);
                }
            });

            var todayDiv = document.getElementById('todaySchedule');
            if (todaySchedules.length === 0) {
                todayDiv.innerHTML = '<p style="color: #718096; text-align: center;">No reading scheduled for today</p>';
            } else {
                todayDiv.innerHTML = todaySchedules.map(function(schedule) {
                    return renderScheduleItem(schedule);
                }).join('');
            }

            var upcomingDiv = document.getElementById('upcomingSchedule');
            if (upcomingSchedules.length === 0) {
                upcomingDiv.innerHTML = '<p style="color: #718096; text-align: center;">No upcoming reading scheduled</p>';
            } else {
                var sortedUpcoming = upcomingSchedules.sort(function(a, b) {
                    return new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time);
                }).slice(0, 5);
                
                upcomingDiv.innerHTML = sortedUpcoming.map(function(schedule) {
                    return renderScheduleItem(schedule);
                }).join('');
            }

            var missedDiv = document.getElementById('missedSchedule');
            var missedSection = document.getElementById('missedReadingSection');
            
            if (missedSchedules.length === 0) {
                missedSection.classList.add('hidden');
            } else {
                missedSection.classList.remove('hidden');
                missedDiv.innerHTML = missedSchedules.map(function(schedule) {
                    return renderScheduleItem(schedule);
                }).join('');
            }

            saveData();
            updateHeaderNotice();
        }

        function renderScheduleItem(schedule) {
            var book = books.find(function(b) { return b.id === schedule.bookId; });
            var bookTitle = book ? book.title : 'Unknown Book';
            
            var scheduleDate = new Date(schedule.date + 'T' + schedule.time);
            var dateString = scheduleDate.toLocaleDateString('en-US', { 
                weekday: 'short', month: 'short', day: 'numeric' 
            });
            var timeString = scheduleDate.toLocaleTimeString('en-US', { 
                hour: '2-digit', minute: '2-digit' 
            });

            var statusClass = 'status-' + schedule.status;
            var statusText = schedule.status.charAt(0).toUpperCase() + schedule.status.slice(1);
            var statusIcon = schedule.status === 'completed' ? '‚úÖ' : 
                           schedule.status === 'missed' ? '‚ùå' : '‚è∞';

            var borderColor = schedule.status === 'completed' ? '#48bb78' :
                            schedule.status === 'missed' ? '#f56565' : '#667eea';

            var actions = '';
            if (schedule.status === 'pending') {
                actions = '<button class="btn btn-success btn-small" onclick="markScheduleComplete(\'' + schedule.id + '\')">‚úÖ Complete</button>' +
                         '<button class="btn btn-danger btn-small" onclick="deleteSchedule(\'' + schedule.id + '\')">üóëÔ∏è Delete</button>';
            } else if (schedule.status === 'missed') {
                actions = '<button class="btn btn-success btn-small" onclick="markScheduleComplete(\'' + schedule.id + '\')">‚úÖ Mark Done</button>' +
                         '<button class="btn btn-danger btn-small" onclick="deleteSchedule(\'' + schedule.id + '\')">üóëÔ∏è Remove</button>';
            } else {
                actions = '<button class="btn btn-secondary btn-small" onclick="deleteSchedule(\'' + schedule.id + '\')">üóëÔ∏è Delete</button>';
            }

            return '<div class="schedule-item ' + (schedule.status === 'completed' ? 'completed' : schedule.status === 'missed' ? 'missed' : '') + '" style="border-left-color: ' + borderColor + '">' +
                '<div class="schedule-info">' +
                '<h4>' + statusIcon + ' ' + bookTitle + '</h4>' +
                '<p><strong>üìÖ ' + dateString + ' at ' + timeString + '</strong> (' + schedule.duration + ' min)</p>' +
                (schedule.notes ? '<p>üìù ' + schedule.notes + '</p>' : '') +
                '<span class="schedule-status ' + statusClass + '">' + statusText + '</span>' +
                '</div>' +
                '<div class="schedule-actions">' + actions + '</div>' +
                '</div>';
        }

        function markScheduleComplete(scheduleId) {
            var schedule = readingSchedules.find(function(s) { return s.id === scheduleId; });
            if (!schedule) return;

            schedule.status = 'completed';
            
            var session = {
                id: Date.now().toString(),
                bookId: schedule.bookId,
                duration: schedule.duration,
                pages: 0,
                notes: schedule.notes + ' (From scheduled reading)',
                date: new Date().toISOString()
            };

            readingSessions.push(session);
            todayReadingTime += schedule.duration * 60;
            weeklyReadingTime += schedule.duration * 60;
            totalReadingTime += schedule.duration * 60;

            saveData();
            updateStats();
            renderSchedules();
            renderSessions();
            showNotification('‚úÖ Reading completed! Great job!');
        }

        function deleteSchedule(scheduleId) {
            if (confirm('Are you sure you want to delete this schedule?')) {
                readingSchedules = readingSchedules.filter(function(s) { return s.id !== scheduleId; });
                saveData();
                renderSchedules();
                showNotification('Schedule deleted!');
            }
        }

        function checkScheduleReminders() {
            var now = new Date();
            var currentTime = now.getTime();

            readingSchedules.forEach(function(schedule) {
                if (schedule.status === 'pending') {
                    var scheduleDateTime = new Date(schedule.date + 'T' + schedule.time).getTime();
                    var timeDiff = scheduleDateTime - currentTime;

                    if (timeDiff > 0 && timeDiff <= 600000 && !schedule.reminded) {
                        var book = books.find(function(b) { return b.id === schedule.bookId; });
                        var bookTitle = book ? book.title : 'Unknown Book';
                        
                        showNotification('‚è∞ Reminder: Time to read "' + bookTitle + '" in 10 minutes!');
                        schedule.reminded = true;
                        saveData();
                    }

                    if (timeDiff > -60000 && timeDiff <= 0 && !schedule.notified) {
                        var book = books.find(function(b) { return b.id === schedule.bookId; });
                        var bookTitle = book ? book.title : 'Unknown Book';
                        
                        showNotification('üìö Time to read "' + bookTitle + '" now!');
                        schedule.notified = true;
                        saveData();
                    }
                }
            });
        }

        // Timer functions
        function startTimer() {
            if (timerInterval) return;
            
            var minutes = parseInt(document.getElementById('timerInput').value);
            if (!minutes || minutes < 1) {
                alert('Please enter a valid time!');
                return;
            }
            
            timerSeconds = minutes * 60;
            updateTimerDisplay();
            
            timerInterval = setInterval(function() {
                timerSeconds--;
                totalReadingTime++;
                todayReadingTime++;
                weeklyReadingTime++;
                
                if (timerSeconds <= 0) {
                    stopTimer();
                    showNotification('‚è∞ Timer completed! Great job!');
                    playSound();
                }
                
                updateTimerDisplay();
                updateStats();
                saveData();
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function resetTimer() {
            stopTimer();
            var minutes = parseInt(document.getElementById('timerInput').value);
            timerSeconds = minutes * 60;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            var minutes = Math.floor(timerSeconds / 60);
            var seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
        }

        function playSound() {
            var audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZUQ0PVanm77BdGAg+ltryxnMnBSl+zPLaizsIGGS57OihUhALTKXh8bllHAU2jdXzzn4yBiZ0wvDglEwNDlOt5O+8aB4FPJbZ88p2KwUme8rx3I4/ChVhtejvrV0YCkCY3PLEcSYELITQ8diKOQcZaLrt56FQDQxPqOLwuWkeB0GY3PLFcSYFLIPP8teIOggYZ7zs6J9PDAtNp+HwtmwhBDWL0/PQgDQGHW/A7+ObUQ4OVKzk77RfGQlBmN3xxXInBS yDz/LVijsIF2e76+mhURAOTazj8btoHwU7k9b0zoA0BiFvwO/jm1EPDlSs5O+yYBoGPpfe8sV1KAUpfsvy2Ys7CRZpu+vpn08NCk+q4/C5aR8FOZXY88t5LQUrdMfx24w+ChVhtejvo1QRCkqm4fG5aR4FO5LW88t5LAUse8rx24s+ChZftejvn08NCk+m4/G5aCAFOpHY9M1+MQUhcsXw3I4+ChZftejvnk0NDEum4vC4aR4FO5HW8814LQYpcMXw3Y0/CRZftejuoE4QDFCN0PO8aSAFPJPW88t3KwUrd8fz3Y0+ChVhtejtoE4QDU6m4vC4aCAGPZPW88t1KwUrd8fz2408ChZhtejvo04QDFGL0PO8aCAFPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx2408ChZgtOjvo04QDU+m4vC5aCAGPJLW88t1KwUrd8fx');
            audio.play();
        }

        // Book functions
        function renderBooks() {
            var grid = document.getElementById('booksGrid');
            var filteredBooks = currentFilter === 'All' 
                ? books 
                : books.filter(function(book) { return book.category === currentFilter; });
            
            if (filteredBooks.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #718096; grid-column: 1/-1;">No books found. Add a new book!</p>';
                return;
            }

            grid.innerHTML = filteredBooks.map(function(book) {
                var authorText = book.author ? '<p style="color: #a0aec0; font-size: 0.9em; margin-top: 5px;">By ' + book.author + '</p>' : '';
                return '<div class="book-card" onclick="viewBook(\'' + book.id + '\')">' +
                    '<h3>' + book.title + '</h3>' +
                    authorText +
                    '<p>' + book.description + '</p>' +
                    '<span class="category-tag">' + book.category + '</span>' +
                    '<p style="margin-top: 10px; color: #667eea; font-weight: 600;">üìñ ' + (book.chapters ? book.chapters.length : 0) + ' Chapters</p>' +
                    '<div class="book-actions" onclick="event.stopPropagation()">' +
                    '<button class="icon-btn" onclick="editBook(\'' + book.id + '\')">‚úèÔ∏è Edit</button>' +
                    '<button class="icon-btn" onclick="deleteBook(\'' + book.id + '\')">üóëÔ∏è Delete</button>' +
                    '</div></div>';
            }).join('');
        }

        function filterCategory(category) {
            currentFilter = category;
            renderCategories();
            renderBooks();
        }

        function renderCategories() {
            var categoriesDiv = document.querySelector('.categories');
            if (!categoriesDiv) return;
            
            var html = '<button class="category-btn ' + (currentFilter === 'All' ? 'active' : '') + '" onclick="filterCategory(\'All\')">All</button>';
            
            categories.forEach(function(cat) {
                html += '<button class="category-btn ' + (currentFilter === cat ? 'active' : '') + '" onclick="filterCategory(\'' + cat + '\')">' + 
                        cat + ' <span onclick="event.stopPropagation(); deleteCategory(\'' + cat + '\')" style="margin-left: 5px; cursor: pointer; font-size: 0.9em;">‚ùå</span></button>';
            });
            
            html += '<button class="btn btn-success btn-small" onclick="addNewCategory()">‚ûï Add Category</button>';
            categoriesDiv.innerHTML = html;
        }

        function addNewCategory() {
            var newCategory = prompt('Enter new category name:');
            if (newCategory && newCategory.trim()) {
                newCategory = newCategory.trim();
                if (categories.indexOf(newCategory) === -1) {
                    categories.push(newCategory);
                    saveData();
                    renderCategories();
                    updateBookCategoryOptions();
                    showNotification('Category added: ' + newCategory);
                } else {
                    alert('This category already exists!');
                }
            }
        }

        function deleteCategory(categoryName) {
            // Check if any books use this category
            var booksWithCategory = books.filter(function(book) {
                return book.category === categoryName;
            });

            if (booksWithCategory.length > 0) {
                if (!confirm('There are ' + booksWithCategory.length + ' book(s) with this category. Delete anyway? (Books will be moved to "Other")')) {
                    return;
                }
                // Move books to "Other" category
                booksWithCategory.forEach(function(book) {
                    book.category = 'Other';
                });
            }

            categories = categories.filter(function(cat) {
                return cat !== categoryName;
            });

            if (currentFilter === categoryName) {
                currentFilter = 'All';
            }

            saveData();
            renderCategories();
            renderBooks();
            updateBookCategoryOptions();
            showNotification('Category deleted: ' + categoryName);
        }

        function updateBookCategoryOptions() {
            var select = document.getElementById('bookCategory');
            if (select) {
                select.innerHTML = categories.map(function(cat) {
                    return '<option>' + cat + '</option>';
                }).join('');
            }
        }

        function updateHeaderNotice() {
            var noticeDiv = document.getElementById('activeScheduleNotice');
            if (!noticeDiv) return;

            var now = new Date();
            var today = now.toDateString();
            
            // Get today's pending schedules
            var todaySchedules = readingSchedules.filter(function(schedule) {
                var scheduleDate = new Date(schedule.date + 'T' + schedule.time);
                return scheduleDate.toDateString() === today && schedule.status === 'pending';
            });

            // Get upcoming schedule (next one within 2 hours)
            var upcomingSchedule = null;
            var twoHoursLater = new Date(now.getTime() + (2 * 60 * 60 * 1000));
            
            todaySchedules.forEach(function(schedule) {
                var scheduleDateTime = new Date(schedule.date + 'T' + schedule.time);
                if (scheduleDateTime >= now && scheduleDateTime <= twoHoursLater) {
                    if (!upcomingSchedule || scheduleDateTime < new Date(upcomingSchedule.date + 'T' + upcomingSchedule.time)) {
                        upcomingSchedule = schedule;
                    }
                }
            });

            // Get missed count
            var missedCount = readingSchedules.filter(function(s) {
                return s.status === 'missed';
            }).length;

            var noticeHTML = '';
            
            if (upcomingSchedule) {
                var book = books.find(function(b) { return b.id === upcomingSchedule.bookId; });
                var bookTitle = book ? book.title : 'Unknown Book';
                var scheduleTime = new Date(upcomingSchedule.date + 'T' + upcomingSchedule.time);
                var timeString = scheduleTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                var minutesUntil = Math.floor((scheduleTime - now) / 60000);
                
                noticeHTML = '‚è∞ <strong>Upcoming:</strong> "' + bookTitle + '" at ' + timeString + ' (' + minutesUntil + ' minutes)';
            } else if (todaySchedules.length > 0) {
                noticeHTML = 'üìö <strong>' + todaySchedules.length + ' reading session(s)</strong> scheduled for today';
            } else {
                noticeHTML = '‚ú® <strong>No reading scheduled for today</strong> - Add a schedule to stay on track!';
            }

            if (missedCount > 0) {
                noticeHTML += ' | <span style="color: #fed7d7;">‚ùå ' + missedCount + ' missed session(s)</span>';
            }

            noticeDiv.innerHTML = noticeHTML;
        }

        function showAddBookForm() {
            editingBookId = null;
            document.getElementById('formTitle').textContent = 'Add New Book';
            document.getElementById('saveBookBtn').textContent = 'üíæ Save Book';
            document.getElementById('bookTitle').value = '';
            document.getElementById('bookDesc').value = '';
            document.getElementById('bookAuthor').value = '';
            
            // Populate category options
            updateBookCategoryOptions();
            document.getElementById('bookCategory').value = categories[0] || 'Fiction';
            
            document.getElementById('libraryView').classList.add('hidden');
            document.getElementById('addBookView').classList.remove('hidden');
        }

        function showLibrary() {
            document.getElementById('libraryView').classList.remove('hidden');
            document.getElementById('addBookView').classList.add('hidden');
            document.getElementById('bookDetailView').classList.add('hidden');
            document.getElementById('chapterDetailView').classList.add('hidden');
            currentBookId = null;
            currentChapterId = null;
            editingBookId = null;
            editingChapterId = null;
        }

        function saveBook() {
            var title = document.getElementById('bookTitle').value.trim();
            var description = document.getElementById('bookDesc').value.trim();
            var category = document.getElementById('bookCategory').value;
            var author = document.getElementById('bookAuthor').value.trim();

            if (!title) {
                alert('Please enter the book title!');
                return;
            }

            if (editingBookId) {
                var book = books.find(function(b) { return b.id === editingBookId; });
                if (book) {
                    book.title = title;
                    book.description = description;
                    book.category = category;
                    book.author = author;
                    showNotification('Book updated successfully!');
                }
            } else {
                var newBook = {
                    id: Date.now().toString(),
                    title: title,
                    description: description,
                    category: category,
                    author: author,
                    chapters: [],
                    createdAt: new Date().toISOString()
                };
                books.push(newBook);
                showNotification('Book added successfully!');
            }

            saveData();
            updateStats();
            showLibrary();
            renderBooks();
        }

        function editBook(bookId) {
            var book = books.find(function(b) { return b.id === bookId; });
            if (!book) return;
            
            editingBookId = bookId;
            document.getElementById('formTitle').textContent = 'Edit Book';
            document.getElementById('saveBookBtn').textContent = '‚úèÔ∏è Update Book';
            document.getElementById('bookTitle').value = book.title;
            document.getElementById('bookDesc').value = book.description;
            document.getElementById('bookAuthor').value = book.author || '';
            
            // Populate category options
            updateBookCategoryOptions();
            document.getElementById('bookCategory').value = book.category;
            
            document.getElementById('libraryView').classList.add('hidden');
            document.getElementById('addBookView').classList.remove('hidden');
        }

        function deleteBook(bookId) {
            if (confirm('Are you sure you want to delete this book?')) {
                books = books.filter(function(b) { return b.id !== bookId; });
                saveData();
                showNotification('Book deleted!');
                updateStats();
                renderBooks();
            }
        }

        function viewBook(bookId) {
            currentBookId = bookId;
            var book = books.find(function(b) { return b.id === bookId; });
            if (!book) return;

            var chaptersHtml = '';
            if (book.chapters && book.chapters.length > 0) {
                chaptersHtml = book.chapters.map(function(chapter) {
                    var topicsHtml = chapter.topics ? chapter.topics.map(function(topic) {
                        return '<span class="topic-tag">' + topic + '</span>';
                    }).join('') : '';
                    
                    var linkHtml = chapter.link ? '<a href="' + chapter.link + '" target="_blank" class="link-tag" onclick="event.stopPropagation()">üìñ Read</a>' : '';
                    
                    return '<div class="chapter-item" onclick="viewChapter(\'' + chapter.id + '\')">' +
                        '<h4>' + chapter.name + '</h4>' +
                        '<div class="topics-list">' + topicsHtml + '</div>' +
                        linkHtml + '</div>';
                }).join('');
            } else {
                chaptersHtml = '<p style="color: #718096;">No chapters added yet.</p>';
            }

            var authorText = book.author ? '<p style="color: #a0aec0; margin: 10px 0;">By ' + book.author + '</p>' : '';

            var content = document.getElementById('bookDetailContent');
            content.innerHTML = '<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">' +
                '<div><h2>' + book.title + '</h2>' +
                authorText + '</div>' +
                '<button class="btn btn-success" onclick="downloadBookPDF(\'' + book.id + '\')">üì• Download PDF</button></div>' +
                '<p style="color: #718096; margin: 15px 0;">' + book.description + '</p>' +
                '<span class="category-tag">' + book.category + '</span>' +
                '<div style="margin-top: 30px;">' +
                '<h3>Chapters</h3>' +
                '<button class="btn btn-primary" style="margin: 15px 0;" onclick="showAddChapterForm()">‚ûï Add New Chapter</button>' +
                '<div id="chaptersList">' + chaptersHtml + '</div></div>' +
                '<div id="addChapterForm" class="hidden" style="margin-top: 20px; padding: 20px; background: #f7fafc; border-radius: 12px;">' +
                '<h4 id="chapterFormTitle">Add New Chapter</h4>' +
                '<div class="form-group"><label>Chapter Name</label>' +
                '<input type="text" id="chapterName" placeholder="Enter chapter name"></div>' +
                '<div class="form-group"><label>Topics</label>' +
                '<div class="input-with-btn">' +
                '<input type="text" id="topicInput" placeholder="Enter topic and click Add">' +
                '<button class="btn btn-secondary btn-small" onclick="addTopic()">Add</button></div>' +
                '<div id="topicsList" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 8px;"></div></div>' +
                '<div class="form-group"><label>Link (Optional)</label>' +
                '<input type="url" id="chapterLink" placeholder="https://example.com"></div>' +
                '<button class="btn btn-primary" id="saveChapterBtn" onclick="saveChapter()">üíæ Save Chapter</button>' +
                '<button class="btn btn-secondary" onclick="cancelChapterForm()">‚ùå Cancel</button></div>';

            document.getElementById('libraryView').classList.add('hidden');
            document.getElementById('bookDetailView').classList.remove('hidden');
        }

        function showAddChapterForm() {
            editingChapterId = null;
            tempTopics = [];
            document.getElementById('chapterFormTitle').textContent = 'Add New Chapter';
            document.getElementById('saveChapterBtn').textContent = 'üíæ Save Chapter';
            document.getElementById('chapterName').value = '';
            document.getElementById('chapterLink').value = '';
            document.getElementById('topicInput').value = '';
            document.getElementById('topicsList').innerHTML = '';
            document.getElementById('addChapterForm').classList.remove('hidden');
        }

        function cancelChapterForm() {
            document.getElementById('addChapterForm').classList.add('hidden');
            tempTopics = [];
            editingChapterId = null;
        }

        function addTopic() {
            var input = document.getElementById('topicInput');
            var topic = input.value.trim();
            if (topic) {
                tempTopics.push(topic);
                input.value = '';
                renderTempTopics();
            }
        }

        function renderTempTopics() {
            var list = document.getElementById('topicsList');
            list.innerHTML = tempTopics.map(function(topic, index) {
                return '<span class="topic-tag" style="cursor: pointer;">' + topic + 
                    ' <span onclick="removeTopic(' + index + ')" style="margin-left: 5px; font-weight: bold;">‚ùå</span></span>';
            }).join('');
        }

        function removeTopic(index) {
            tempTopics.splice(index, 1);
            renderTempTopics();
        }

        function saveChapter() {
            var chapterName = document.getElementById('chapterName').value.trim();
            var link = document.getElementById('chapterLink').value.trim();

            if (!chapterName) {
                alert('Please enter the chapter name!');
                return;
            }

            var book = books.find(function(b) { return b.id === currentBookId; });
            if (!book) return;

            if (!book.chapters) book.chapters = [];

            if (editingChapterId) {
                var chapter = book.chapters.find(function(c) { return c.id === editingChapterId; });
                if (chapter) {
                    chapter.name = chapterName;
                    chapter.topics = tempTopics.slice();
                    chapter.link = link;
                    showNotification('Chapter updated!');
                }
            } else {
                var newChapter = {
                    id: Date.now().toString(),
                    name: chapterName,
                    topics: tempTopics.slice(),
                    link: link,
                    createdAt: new Date().toISOString()
                };
                book.chapters.push(newChapter);
                showNotification('Chapter added successfully!');
            }

            saveData();
            updateStats();
            editingChapterId = null;
            viewBook(currentBookId);
        }

        function viewChapter(chapterId) {
            currentChapterId = chapterId;
            var book = books.find(function(b) { return b.id === currentBookId; });
            var chapter = book.chapters.find(function(c) { return c.id === chapterId; });
            if (!chapter) return;

            var topicsHtml = '';
            if (chapter.topics && chapter.topics.length > 0) {
                topicsHtml = chapter.topics.map(function(topic) {
                    return '<span class="topic-tag">' + topic + '</span>';
                }).join('');
            } else {
                topicsHtml = '<p style="color: #718096;">No topics added.</p>';
            }

            var linkHtml = chapter.link ? '<div style="margin-top: 20px;"><a href="' + chapter.link + '" target="_blank" class="link-tag">üìñ Click here to read</a></div>' : '';

            var content = document.getElementById('chapterDetailContent');
            content.innerHTML = '<h2>' + chapter.name + '</h2>' +
                '<div style="margin-top: 20px;"><h3>Topics</h3>' +
                '<div class="topics-list" style="margin-top: 15px;">' + topicsHtml + '</div></div>' +
                linkHtml +
                '<div style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">' +
                '<button class="btn btn-primary" onclick="editChapter()">‚úèÔ∏è Edit</button>' +
                '<button class="btn btn-danger" onclick="deleteChapter()">üóëÔ∏è Delete</button></div>';

            document.getElementById('bookDetailView').classList.add('hidden');
            document.getElementById('chapterDetailView').classList.remove('hidden');
        }

        function editChapter() {
            var book = books.find(function(b) { return b.id === currentBookId; });
            var chapter = book.chapters.find(function(c) { return c.id === currentChapterId; });
            if (!chapter) return;
            
            editingChapterId = currentChapterId;
            document.getElementById('chapterDetailView').classList.add('hidden');
            document.getElementById('bookDetailView').classList.remove('hidden');
            
            setTimeout(function() {
                document.getElementById('chapterFormTitle').textContent = 'Edit Chapter';
                document.getElementById('saveChapterBtn').textContent = '‚úèÔ∏è Update Chapter';
                document.getElementById('addChapterForm').classList.remove('hidden');
                document.getElementById('chapterName').value = chapter.name;
                document.getElementById('chapterLink').value = chapter.link || '';
                tempTopics = chapter.topics ? chapter.topics.slice() : [];
                renderTempTopics();
            }, 100);
        }

        function deleteChapter() {
            if (confirm('Are you sure you want to delete this chapter?')) {
                var book = books.find(function(b) { return b.id === currentBookId; });
                book.chapters = book.chapters.filter(function(c) { return c.id !== currentChapterId; });
                saveData();
                showNotification('Chapter deleted!');
                updateStats();
                viewBook(currentBookId);
            }
        }

        function backToBook() {
            document.getElementById('chapterDetailView').classList.add('hidden');
            document.getElementById('bookDetailView').classList.remove('hidden');
        }

        // Timetable functions
        function renderTimetable() {
            var grid = document.getElementById('timetableGrid');
            var html = '<div class="timetable-cell timetable-header">Time</div>';
            
            weekDays.forEach(function(day) {
                html += '<div class="timetable-cell timetable-header">' + day + '</div>';
            });

            timeSlots.forEach(function(time) {
                html += '<div class="timetable-cell timetable-time">' + time + '</div>';
                weekDays.forEach(function(day) {
                    var key = day + '-' + time;
                    var slot = timetable[key] || '';
                    var filledClass = slot ? 'filled' : '';
                    html += '<div class="timetable-cell timetable-slot ' + filledClass + '" onclick="editSlot(\'' + key + '\')">' +
                        '<div class="slot-content">' + slot + '</div></div>';
                });
            });

            grid.innerHTML = html;
        }

        function editSlot(key) {
            var value = prompt('Enter study activity:', timetable[key] || '');
            if (value !== null) {
                if (value.trim()) {
                    timetable[key] = value.trim();
                } else {
                    delete timetable[key];
                }
                saveData();
                renderTimetable();
            }
        }

        // Reading sessions functions
        function renderSessions() {
            var list = document.getElementById('sessionsList');
            if (readingSessions.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #718096;">No reading sessions logged yet.</p>';
                return;
            }

            var sortedSessions = readingSessions.slice().sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            });

            list.innerHTML = sortedSessions.map(function(session) {
                var book = books.find(function(b) { return b.id === session.bookId; });
                var bookTitle = book ? book.title : 'Unknown Book';
                var date = new Date(session.date).toLocaleDateString('en-US', { 
                    month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' 
                });
                
                return '<div class="log-entry">' +
                    '<div class="log-info">' +
                    '<strong>' + bookTitle + '</strong>' +
                    '<p style="color: #718096; font-size: 0.9em; margin-top: 5px;">' + date + '</p>' +
                    (session.pages ? '<p style="color: #667eea; font-size: 0.9em;">üìÑ ' + session.pages + ' pages</p>' : '') +
                    (session.notes ? '<p style="color: #718096; font-size: 0.9em; margin-top: 5px;">' + session.notes + '</p>' : '') +
                    '</div>' +
                    '<div class="log-time">' + session.duration + ' min</div>' +
                    '</div>';
            }).join('');
        }

        function showAddSessionForm() {
            var select = document.getElementById('sessionBook');
            select.innerHTML = books.map(function(book) {
                return '<option value="' + book.id + '">' + book.title + '</option>';
            }).join('');
            
            if (books.length === 0) {
                alert('Please add some books first!');
                return;
            }

            document.getElementById('sessionDuration').value = '30';
            document.getElementById('sessionPages').value = '0';
            document.getElementById('sessionNotes').value = '';
            document.getElementById('addSessionForm').classList.remove('hidden');
        }

        function cancelSessionForm() {
            document.getElementById('addSessionForm').classList.add('hidden');
        }

        function saveSession() {
            var bookId = document.getElementById('sessionBook').value;
            var duration = parseInt(document.getElementById('sessionDuration').value);
            var pages = parseInt(document.getElementById('sessionPages').value);
            var notes = document.getElementById('sessionNotes').value.trim();

            if (!bookId || !duration || duration < 1) {
                alert('Please fill in all required fields!');
                return;
            }

            var session = {
                id: Date.now().toString(),
                bookId: bookId,
                duration: duration,
                pages: pages,
                notes: notes,
                date: new Date().toISOString()
            };

            readingSessions.push(session);
            todayReadingTime += duration * 60;
            weeklyReadingTime += duration * 60;
            totalReadingTime += duration * 60;

            saveData();
            updateStats();
            renderSessions();
            cancelSessionForm();
            showNotification('Reading session logged!');
        }

        // Notice board functions
        function renderNotices() {
            var board = document.getElementById('noticeBoard');
            if (notices.length === 0) {
                board.innerHTML = '<p style="text-align: center; color: #718096;">No notices yet. Add your first notice!</p>';
                return;
            }

            var sortedNotices = notices.slice().sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            });

            board.innerHTML = sortedNotices.map(function(notice) {
                var date = new Date(notice.date).toLocaleDateString('en-US', { 
                    month: 'short', day: 'numeric', year: 'numeric' 
                });
                var priorityColor = notice.priority === 'High' ? '#f56565' : 
                                   notice.priority === 'Medium' ? '#ed8936' : '#48bb78';
                
                return '<div class="notice-item" style="border-left-color: ' + priorityColor + '">' +
                    '<h4>' + notice.title + ' <span style="background: ' + priorityColor + '; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.75em; margin-left: 10px;">' + notice.priority + '</span></h4>' +
                    '<p>' + notice.content + '</p>' +
                    '<div class="notice-date">' + date + '</div>' +
                    '<button class="btn btn-danger btn-small" style="margin-top: 10px;" onclick="deleteNotice(\'' + notice.id + '\')">üóëÔ∏è Delete</button>' +
                    '</div>';
            }).join('');
        }

        function showAddNoticeForm() {
            document.getElementById('noticeTitle').value = '';
            document.getElementById('noticeContent').value = '';
            document.getElementById('noticePriority').value = 'High';
            document.getElementById('addNoticeForm').classList.remove('hidden');
        }

        function cancelNoticeForm() {
            document.getElementById('addNoticeForm').classList.add('hidden');
        }

        function saveNotice() {
            var title = document.getElementById('noticeTitle').value.trim();
            var content = document.getElementById('noticeContent').value.trim();
            var priority = document.getElementById('noticePriority').value;

            if (!title || !content) {
                alert('Please fill in all fields!');
                return;
            }

            var notice = {
                id: Date.now().toString(),
                title: title,
                content: content,
                priority: priority,
                date: new Date().toISOString()
            };

            notices.push(notice);
            saveData();
            renderNotices();
            cancelNoticeForm();
            showNotification('Notice added!');
        }

        function deleteNotice(noticeId) {
            if (confirm('Are you sure you want to delete this notice?')) {
                notices = notices.filter(function(n) { return n.id !== noticeId; });
                saveData();
                renderNotices();
                showNotification('Notice deleted!');
            }
        }

        // Goals functions
        function renderGoals() {
            var list = document.getElementById('goalsList');
            if (goals.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #718096;">No goals set yet. Set your first reading goal!</p>';
                return;
            }

            list.innerHTML = goals.map(function(goal) {
                var progress = calculateGoalProgress(goal);
                var progressPercent = Math.min(100, (progress / goal.target) * 100);
                
                return '<div class="goal-card">' +
                    '<h3>' + goal.type + '</h3>' +
                    '<p>' + goal.period + ' Goal: ' + goal.target + '</p>' +
                    '<div class="progress-bar">' +
                    '<div class="progress-fill" style="width: ' + progressPercent + '%">' +
                    progress + ' / ' + goal.target + '</div></div>' +
                    '<button class="btn btn-danger btn-small" style="margin-top: 15px;" onclick="deleteGoal(\'' + goal.id + '\')">üóëÔ∏è Delete Goal</button>' +
                    '</div>';
            }).join('');
        }

        function calculateGoalProgress(goal) {
            if (goal.type === 'Books to Read') {
                return books.length;
            } else if (goal.type === 'Pages to Read') {
                return readingSessions.reduce(function(sum, session) {
                    return sum + (session.pages || 0);
                }, 0);
            } else if (goal.type === 'Reading Time (hours)') {
                if (goal.period === 'Weekly') {
                    return Math.floor(weeklyReadingTime / 3600);
                } else {
                    return Math.floor(totalReadingTime / 3600);
                }
            } else if (goal.type === 'Chapters to Complete') {
                var totalChapters = 0;
                books.forEach(function(book) {
                    if (book.chapters) {
                        totalChapters += book.chapters.length;
                    }
                });
                return totalChapters;
            }
            return 0;
        }

        function showAddGoalForm() {
            document.getElementById('goalType').value = 'Books to Read';
            document.getElementById('goalTarget').value = '1';
            document.getElementById('goalPeriod').value = 'Weekly';
            document.getElementById('addGoalForm').classList.remove('hidden');
        }

        function cancelGoalForm() {
            document.getElementById('addGoalForm').classList.add('hidden');
        }

        function saveGoal() {
            var type = document.getElementById('goalType').value;
            var target = parseInt(document.getElementById('goalTarget').value);
            var period = document.getElementById('goalPeriod').value;

            if (!target || target < 1) {
                alert('Please enter a valid target!');
                return;
            }

            var goal = {
                id: Date.now().toString(),
                type: type,
                target: target,
                period: period,
                createdAt: new Date().toISOString()
            };

            goals.push(goal);
            saveData();
            renderGoals();
            cancelGoalForm();
            showNotification('Goal added!');
        }

        function deleteGoal(goalId) {
            if (confirm('Are you sure you want to delete this goal?')) {
                goals = goals.filter(function(g) { return g.id !== goalId; });
                saveData();
                renderGoals();
                showNotification('Goal deleted!');
            }
        }

        // Notification function
        function showNotification(message) {
            var notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(function() {
                notification.remove();
            }, 3000);
        }

        // Download Book as PDF function
        function downloadBookPDF(bookId) {
            var book = books.find(function(b) { return b.id === bookId; });
            if (!book) return;

            var { jsPDF } = window.jspdf;
            var doc = new jsPDF();
            var pageWidth = doc.internal.pageSize.getWidth();
            var pageHeight = doc.internal.pageSize.getHeight();
            var margin = 20;
            var contentWidth = pageWidth - (2 * margin);
            var yPosition = margin;

            // Helper function to add page break if needed
            function checkPageBreak(requiredSpace) {
                if (yPosition + requiredSpace > pageHeight - margin - 15) {
                    doc.addPage();
                    yPosition = margin;
                    addPageBorder();
                    return true;
                }
                return false;
            }

            // Helper function to add decorative border
            function addPageBorder() {
                // Outer border - gradient effect with multiple colors
                doc.setDrawColor(102, 126, 234);
                doc.setLineWidth(3);
                doc.rect(8, 8, pageWidth - 16, pageHeight - 16);
                
                doc.setDrawColor(118, 75, 162);
                doc.setLineWidth(1);
                doc.rect(11, 11, pageWidth - 22, pageHeight - 22);
                
                doc.setDrawColor(72, 187, 120);
                doc.setLineWidth(0.5);
                doc.rect(13, 13, pageWidth - 26, pageHeight - 26);
            }

            // Add border to first page
            addPageBorder();

            // Elegant Header Box with gradient effect
            doc.setFillColor(102, 126, 234);
            doc.roundedRect(margin, yPosition, contentWidth, 45, 5, 5, 'F');
            
            // Inner accent box
            doc.setFillColor(118, 75, 162);
            doc.roundedRect(margin + 2, yPosition + 2, contentWidth - 4, 41, 4, 4, 'F');
            
            // Header text
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            doc.text('üìö Personal Library Collection', pageWidth / 2, yPosition + 15, { align: 'center' });
            
            doc.setFontSize(24);
            doc.setFont(undefined, 'bold');
            doc.text('RAJU AGYANI', pageWidth / 2, yPosition + 32, { align: 'center' });
            
            yPosition += 55;

            // Decorative separator
            doc.setDrawColor(102, 126, 234);
            doc.setLineWidth(0.5);
            for (var i = 0; i < 5; i++) {
                doc.circle(margin + (i * (contentWidth / 4)), yPosition, 1, 'F');
            }
            yPosition += 10;

            // Book Title Section with attractive background
            checkPageBreak(50);
            
            // Title background box
            var titleLines = doc.splitTextToSize(book.title, contentWidth - 20);
            var titleHeight = (titleLines.length * 12) + 20;
            
            doc.setFillColor(247, 250, 252);
            doc.roundedRect(margin, yPosition, contentWidth, titleHeight, 8, 8, 'F');
            
            // Decorative side bar
            doc.setFillColor(102, 126, 234);
            doc.roundedRect(margin, yPosition, 8, titleHeight, 4, 4, 'F');
            
            // Book title
            doc.setTextColor(102, 126, 234);
            doc.setFontSize(26);
            doc.setFont(undefined, 'bold');
            doc.text(titleLines, margin + 15, yPosition + 15);
            
            yPosition += titleHeight + 10;

            // Author Section (if available)
            if (book.author) {
                checkPageBreak(25);
                
                doc.setFillColor(237, 242, 247);
                doc.roundedRect(margin, yPosition, contentWidth, 15, 5, 5, 'F');
                
                doc.setTextColor(72, 187, 120);
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text('‚úçÔ∏è Author:', margin + 10, yPosition + 7);
                
                doc.setTextColor(45, 55, 72);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(book.author, margin + 35, yPosition + 10);
                
                yPosition += 20;
            }

            // Category Badge with icon
            checkPageBreak(25);
            
            var categoryWidth = doc.getTextWidth(book.category) + 20;
            doc.setFillColor(72, 187, 120);
            doc.roundedRect(margin, yPosition, categoryWidth, 12, 6, 6, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text('üìÇ ' + book.category, margin + 10, yPosition + 8);
            
            yPosition += 20;

            // Description Section with better spacing
            if (book.description) {
                checkPageBreak(60);
                
                // Description box
                doc.setFillColor(255, 250, 240);
                doc.roundedRect(margin, yPosition, contentWidth, 10, 5, 5, 'FD');
                
                doc.setTextColor(237, 137, 54);
                doc.setFontSize(13);
                doc.setFont(undefined, 'bold');
                doc.text('üìñ Description', margin + 10, yPosition + 7);
                
                yPosition += 15;
                
                // Description content box
                var descLines = doc.splitTextToSize(book.description, contentWidth - 20);
                var descContentHeight = (descLines.length * 6) + 10;
                
                doc.setFillColor(255, 255, 255);
                doc.setDrawColor(237, 137, 54);
                doc.setLineWidth(0.5);
                doc.roundedRect(margin, yPosition, contentWidth, descContentHeight, 5, 5, 'FD');
                
                doc.setTextColor(71, 85, 105);
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                doc.text(descLines, margin + 10, yPosition + 7);
                
                yPosition += descContentHeight + 15;
            }

            // Book Information Table with attractive header
            checkPageBreak(70);
            
            // Section header
            doc.setFillColor(102, 126, 234);
            doc.roundedRect(margin, yPosition, contentWidth, 12, 5, 5, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('üìä Book Information', margin + 10, yPosition + 8);
            yPosition += 17;

            var bookInfoData = [
                ['üìö Total Chapters', (book.chapters ? book.chapters.length : 0).toString()],
                ['üìÇ Category', book.category],
                ['üìÖ Date Added', new Date(book.createdAt).toLocaleDateString('en-US', { day: 'numeric', month: 'long', year: 'numeric' })]
            ];

            if (book.author) {
                bookInfoData.splice(1, 0, ['‚úçÔ∏è Author', book.author]);
            }

            doc.autoTable({
                startY: yPosition,
                head: [['Property', 'Value']],
                body: bookInfoData,
                theme: 'grid',
                headStyles: {
                    fillColor: [102, 126, 234],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    halign: 'center',
                    fontSize: 12
                },
                bodyStyles: {
                    textColor: [45, 55, 72],
                    fontSize: 11
                },
                alternateRowStyles: {
                    fillColor: [247, 250, 252]
                },
                margin: { left: margin, right: margin },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 70, fillColor: [237, 242, 247] },
                    1: { cellWidth: 'auto' }
                }
            });

            yPosition = doc.lastAutoTable.finalY + 20;

            // Chapters Section
            if (book.chapters && book.chapters.length > 0) {
                checkPageBreak(50);
                
                // Add new page for chapters if needed
                if (yPosition > pageHeight - 100) {
                    doc.addPage();
                    addPageBorder();
                    yPosition = margin;
                }

                // Chapters header with gradient effect
                doc.setFillColor(102, 126, 234);
                doc.roundedRect(margin, yPosition, contentWidth, 18, 5, 5, 'F');
                
                doc.setFillColor(118, 75, 162);
                doc.roundedRect(margin + 2, yPosition + 2, contentWidth - 4, 14, 4, 4, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('üìö Chapters & Topics', pageWidth / 2, yPosition + 12, { align: 'center' });
                yPosition += 28;

                book.chapters.forEach(function(chapter, index) {
                    // Check if we need a new page for this chapter
                    var estimatedHeight = 70 + (chapter.topics ? chapter.topics.length * 8 : 0);
                    if (checkPageBreak(estimatedHeight)) {
                        // Border already added by checkPageBreak
                    }

                    // Chapter number badge
                    doc.setFillColor(72, 187, 120);
                    doc.circle(margin + 10, yPosition + 5, 8, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text((index + 1).toString(), margin + 10, yPosition + 7, { align: 'center' });

                    // Chapter header box
                    doc.setFillColor(240, 253, 244);
                    doc.setDrawColor(72, 187, 120);
                    doc.setLineWidth(1);
                    doc.roundedRect(margin + 20, yPosition, contentWidth - 20, 14, 5, 5, 'FD');
                    
                    doc.setTextColor(22, 101, 52);
                    doc.setFontSize(13);
                    doc.setFont(undefined, 'bold');
                    var chapterText = doc.splitTextToSize('Chapter ' + (index + 1) + ': ' + chapter.name, contentWidth - 30);
                    doc.text(chapterText, margin + 25, yPosition + 9);
                    yPosition += 20;

                    // Topics Table
                    if (chapter.topics && chapter.topics.length > 0) {
                        var topicsTableData = chapter.topics.map(function(topic, i) {
                            return [(i + 1).toString(), topic];
                        });

                        doc.autoTable({
                            startY: yPosition,
                            head: [['#', 'Topic']],
                            body: topicsTableData,
                            theme: 'striped',
                            headStyles: {
                                fillColor: [72, 187, 120],
                                textColor: [255, 255, 255],
                                fontStyle: 'bold',
                                fontSize: 11
                            },
                            bodyStyles: {
                                textColor: [45, 55, 72],
                                fontSize: 10
                            },
                            alternateRowStyles: {
                                fillColor: [240, 253, 244]
                            },
                            margin: { left: margin + 5, right: margin + 5 },
                            columnStyles: {
                                0: { cellWidth: 15, halign: 'center', fontStyle: 'bold', fillColor: [237, 242, 247] },
                                1: { cellWidth: 'auto' }
                            }
                        });

                        yPosition = doc.lastAutoTable.finalY + 5;
                    } else {
                        doc.setTextColor(160, 174, 192);
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'italic');
                        doc.text('No topics added', margin + 30, yPosition);
                        yPosition += 10;
                    }

                    // Link if available
                    if (chapter.link) {
                        doc.setFillColor(254, 243, 199);
                        doc.roundedRect(margin + 25, yPosition, contentWidth - 30, 10, 3, 3, 'F');
                        
                        doc.setTextColor(180, 83, 9);
                        doc.setFontSize(9);
                        doc.setFont(undefined, 'normal');
                        doc.textWithLink('üîó Link: ' + chapter.link, margin + 30, yPosition + 6, { url: chapter.link });
                        yPosition += 12;
                    }

                    yPosition += 15; // Space between chapters
                });
            } else {
                checkPageBreak(30);
                doc.setFillColor(254, 243, 199);
                doc.roundedRect(margin, yPosition, contentWidth, 15, 5, 5, 'F');
                doc.setTextColor(180, 83, 9);
                doc.setFontSize(12);
                doc.setFont(undefined, 'italic');
                doc.text('No chapters added yet', pageWidth / 2, yPosition + 10, { align: 'center' });
            }

            // Footer on all pages
            var totalPages = doc.internal.getNumberOfPages();
            for (var i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                
                // Footer background
                doc.setFillColor(102, 126, 234);
                doc.rect(0, pageHeight - 15, pageWidth, 15, 'F');
                
                // Footer text
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(8);
                doc.setFont(undefined, 'normal');
                doc.text('üìö Generated from Personal Library - RAJU AGYANI', pageWidth / 2, pageHeight - 8, { align: 'center' });
                
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text('Page ' + i + ' of ' + totalPages, pageWidth - 15, pageHeight - 8, { align: 'right' });
                
                // Date on left
                var currentDate = new Date().toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' });
                doc.text(currentDate, 15, pageHeight - 8, { align: 'left' });
            }

            // Save the PDF
            var fileName = book.title.replace(/[^a-z0-9]/gi, '_').toLowerCase() + '_by_raju_agyani.pdf';
            doc.save(fileName);
            showNotification('üì• PDF downloaded successfully!');
        }

        // Initialize app on load
        window.onload = init;
    </script>
</body>
</html>